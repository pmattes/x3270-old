# Makefile for wc3270

# Figure out if they've installed MinGW OpenSSL.
SSLDIR = /usr/local/mingw-openssl
HAVE_OPENSSL = $(shell [ -d $(SSLDIR) ] && echo yes)
ifeq ($(HAVE_OPENSSL),yes)
SSLCPP = -DHAVE_LIBSSL=1 -I$(SSLDIR)/include
SSLLIB = -L$(SSLDIR)/lib -lssl -lcrypto -lwsock32 -ladvapi32 -lgdi32 -luser32
endif

CC = gcc
XCPPFLAGS = -D_WIN32 -DWC3270
CFLAGS = -mno-cygwin -g -Wall -Werror $(XCPPFLAGS) -I. $(SSLCPP)
SRCS = XtGlue.c actions.c ansi.c apl.c wc3270.c charset.c ctlr.c \
	ft.c ft_cut.c ft_dft.c glue.c help.c host.c icmd.c idle.c kybd.c \
	macros.c print.c printer.c resources.c rpq.c screen.c see.c \
	sf.c tables.c telnet.c toggles.c trace_ds.c util.c \
	xio.c fallbacks.c keymap.c
OBJECTS = XtGlue.o actions.o ansi.o apl.o wc3270.o charset.o ctlr.o \
	ft.o ft_cut.o ft_dft.o glue.o help.o host.o icmd.o idle.o kybd.o \
	macros.o print.o printer.o resources.o rpq.o screen.o see.o \
	sf.o tables.o telnet.o toggles.o trace_ds.o util.o \
	xio.o version.o fallbacks.o keymap.o wc3270res.o
LIBS = $(SSLLIB) -lws2_32
SHRTLIBS = -lole32 -luuid
WIZLIBS = -lole32 -luuid -lwinspool

all: wc3270.exe mkshort.exe wc3270wiz.exe

version.o: $(VOBJS) version.txt mkversion.sh Makefile
	@chmod +x mkversion.sh version.txt
	sh ./mkversion.sh $(CC) wc3270

fallbacks.c: mkfb.exe X3270.xad Makefile
	$(RM) $@
	./mkfb -c X3270.xad $@

mkfb.exe: mkfb.c Makefile
	$(CC) -g -o mkfb -D_WIN32 mkfb.c

wc3270res.o: wc3270.rc x3270-icon2.ico Makefile
	windres -i wc3270.rc -o wc3270res.o

wc3270.exe: $(OBJECTS) Makefile
	$(CC) -o wc3270 $(CFLAGS) $(OBJECTS) $(LIBS)

mkshort.exe: mkshort.o Makefile
	$(CC) -o mkshort $(CFLAGS) mkshort.o $(SHRTLIBS)

wversion.o: version.txt mkwversion.sh
	@chmod +x mkwversion.sh version.txt
	sh ./mkwversion.sh $(CC)

wc3270wiz.exe: wizard.o wc3270res.o wversion.o
	$(CC) -o wc3270wiz $(CFLAGS) wizard.o wc3270res.o wversion.o $(WIZLIBS)

clean:
	rm -f *.o mkfb.exe fallbacks.c

clobber: clean
	rm -f wc3270.exe mkshort.exe wc3270wiz.exe

depend:
	gccmakedep -fMakefile $(XCPPFLAGS) -s "# DO NOT DELETE" $(SRCS)

# -------------------------------------------------------------------------
# dependencies generated by makedepend

# DO NOT DELETE
